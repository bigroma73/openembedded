#@TYPE: Machine
#@NAME: 4G Systems mtx-2
#@DESCRIPTION: Machine configuration for the mtx-2 (aka SurfBox 2nd generation)

TARGET_ARCH = "mipsel"
PACKAGE_ARCHS = "all mipsel ${MACHINE}"

PREFERRED_PROVIDER_virtual/kernel = "linux-mtx-2"
KERNEL_VERSION_mtx-2 = "2.4.27"
MACHINE_FEATURES = "kernel24 usbhost vfat"

EXTRA_IMAGECMD_jffs2 = "--little-endian --eraseblock=0x20000 -n"  

# does not gain any speed and just creates problems:
# TARGET_CC_ARCH = "-march=mips32" 

USE_DEVFS = "1"
USE_VT = "0"
SERIAL_CONSOLE = "115200 tts/0 vt100"

BOOTSTRAP_EXTRA_RDEPENDS += "kernel-module-usb-storage kernel-module-scsi-mod kernel-module-sd-mod kernel-module-fat kernel-module-vfat kernel-module-usbnet kernel-module-mii"

PREFERRED_VERSION_yamon = "2.24"

# create srec files
IMAGE_POSTPROCESS_COMMAND += "\
	${TARGET_PREFIX}objcopy -O srec -I binary --adjust-vma 0xbe000000 ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.${type} ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.srec; \
	grep -v S7 ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.srec > ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.srec; \
	grep -v S0 ${DEPLOY_DIR_IMAGE}/${KERNEL_IMAGE_NAME}.flash.srec >> ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.srec; "
